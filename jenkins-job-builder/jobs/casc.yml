---
- job:
    name: update-casc-config
    display-name: "Update Configuration-as-Code configuration"
    scm:
      - git:
          url: https://github.com/tizianatroukens/jenkins-kubernetes.git
          branches:
            - origin/master
    triggers:
      - pollscm:
          cron: "* * * * *"
          enable-concurrent: false
    builders:
      - shell: |
          # crumb=`wget -q --auth-no-challenge --user admin --password admin123 --output-document - 'http://10.0.212.146:30901/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,":",//crumb)'`
          crumb=`curl --insecure -s -u admin:admin123 'http://10.0.212.146:30902/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,":",//crumb)' 2>&1`
          curl -X POST "http://10.0.212.146:30902/configuration-as-code/reload" -H $crumb -u admin:admin123
